<html>
  <head>
    <title>üï∂Ô∏è Members Only</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cabin:ital,wdth,wght@0,75..100,400..700;1,75..100,400..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css">
  </head>
  <body>
    <header>
      <h1>üï∂Ô∏è MembersOnly</h1>
    </header>    
    <main>
      <div class="home-left">
        <% if (user) {%>
          <div class="welcome-user">
            <h2>Welcome back, <%= user.user_name %></h1>
            <button class="button-9" onclick="window.location.href='/log-out';">Log Out</button>        </div>
          <%- include('new-message-form') %>
        <% } else { %>
          <div class="welcome">
            <h2>Welcome to MembersOnly</h2>
            <p>Only members can post messages and see other members' names.</p>
          </div>
          <div class="login-box">
            <h2>Login</h2>
            <form action="/log-in" method="POST">
              <div class="user-box">
                <input id="username" name="username" type="text" required=""/>
                <label>Username</label>
              </div>
              <div class="user-box">
                <input id="password" name="password" type="password" required=""/>
                <label>Password</label>
              </div>
              <button class="button-9">Log In</button>
            </form>
            <p>Not a member? <a href="/sign-up">Sign Up</a></p>
          </div>
        <%}%>
      </div>
      <div class="home-right">
        <ul class="messageBoard">
          <% messages.forEach( (message) => { %>
            <li class="message">
            <% if (user) {%>
              <p class="author">üï∂Ô∏è <%= message.user_name %></p>
              <div class="messageTextContainer">
                <% if (user.isadmin) {%>
                  <form class="deleteMessageForm" id="deleteMessageForm" action="./<%= message.message_id %>/delete" method="POST">
                    <input type="hidden" id="message_id" name="message_id" value="<%= message.message_id %>">
                    <button class="btn delete button-9" type="submit">-</button>
                  </form>
                <%};%>
                <p class="messageText"><%= message.message_text %></p>
              </div>
              <% if (user) {%>
              <p class="date"><%= message.message_date.toLocaleString('en-GB', { timeZone: 'UTC' }) %></p>
              <%}%>
              </li>
            <% } else { %>
              <p class="author">üï∂Ô∏è Hidden Member</p>
              <div class="messageTextContainer">
                <p class="messageText"><%= message.message_text %></p>
              </div>
            <%}%>
          <%});%>

        </ul>
      </div>
    </main>    
    <%- include('footer') %>
  </body>
</html>